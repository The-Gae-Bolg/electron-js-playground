<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>CodePlay JS</title>
    <style>
        @font-face {
            font-family: 'Cascadia Code PL';
            src: url('CascadiaCodePL.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Cascadia Code PL', 'Consolas', 'Monaco', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            background: #181c20;
            color: #e0e0e0;
        }

        .header {
            background: #181c20;
            color: #e0e0e0;
            padding: 10px 20px;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px #0002;
        }

        .run-button {
            background: linear-gradient(90deg, #3a7bd5 0%, #00d2ff 100%);
            color: #fff;
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-family: 'Cascadia Code PL', monospace;
            font-weight: bold;
            box-shadow: 0 2px 8px #0003;
            transition: background 0.3s, box-shadow 0.3s;
        }

        .run-button:hover {
            background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
            box-shadow: 0 4px 16px #0005;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            background: #181c20;
        }

        .container.horizontal {
            flex-direction: row;
        }

        .container.vertical {
            flex-direction: column;
        }

        .resizer {
            background: #4d7dc013;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .container.horizontal .resizer {
            width: 6px;
            cursor: col-resize;
            height: 100%;
        }

        .container.vertical .resizer {
            height: 6px;
            cursor: row-resize;
            width: 100%;
        }

        .resizer:hover {
            background: #4d7dc081;
        }

        .editor-container,
        .output-container {
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
            min-width: 100px;
            min-height: 100px;
            background: #181c20;
        }

        .editor-container {
            border-right: 1px solid #181c20;
        }

        .editor {
            flex: 1 1 auto;
            border: 1px solid #181c20;
            border-radius: 6px;
            overflow: hidden;
            min-height: 50px;
            background: #181c20;
        }

        .output-container {
            background: #181c20;
        }

        .output {
            flex: 1 1 auto;
            background: #1e1e1e;
            border: 1px solid #23272e;
            border-radius: 6px;
            padding: 14px 14px 14px 18px;
            overflow-y: auto;
            font-family: 'Cascadia Code PL', 'Consolas', 'Monaco', monospace;
            font-size: 15px;
            color: #e0e0e0;
            white-space: pre-wrap;
            min-height: 50px;
            box-shadow: 0 2px 8px #0002;
        }

        .output-title {
            margin: 0 0 10px 0;
            color: #fff;
            font-size: 15px;
            font-weight: bold;
            letter-spacing: 0.5px;
            font-family: 'Cascadia Code PL', monospace;
        }

        .success {
            color: #7ecfff;
        }

        .error {
            color: #ff6b6b;
        }

        #output-content {
            margin: 0;
        }

        #toggle-orientation {
            color: #7ecfff;
            transition: color 0.2s;
        }

        #toggle-orientation:hover {
            color: #00d2ff;
        }

        /* Monaco Editor theme override */
        .editor,
        .output,
        .output-title,
        .run-button,
        .monaco-editor,
        .monaco-editor-background,
        .monaco-editor .inputarea.ime-input {
            font-family: 'Cascadia Code PL', 'Consolas', 'Monaco', monospace !important;
        }

        .switch-label {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 18px;
        }

        .switch-label input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #333;
            border-radius: 18px;
            transition: background 0.2s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 3px;
            bottom: 3px;
            background: #baffb8;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .switch-label input:checked+.slider {
            background: linear-gradient(90deg, #7ecfff 0%, #00d2ff 100%);
        }

        .switch-label input:checked+.slider:before {
            transform: translateX(16px);
        }

        .manual-hint {
            color: #fff;
            font-size: 0.75em;
            background: transparent;
            border-radius: 3px;
            padding: 0 6px;
            margin-left: 2px;
            font-family: 'Cascadia Code PL', monospace;
            opacity: 0.7;
            user-select: none;
            font-weight: normal;
            letter-spacing: 0.1em;
        }

        .menu-button {
            background: #181c20;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            font-family: 'Cascadia Code PL', monospace;
            font-weight: bold;
            box-shadow: 0 2px 8px #0003;
            transition: background 0.3s, box-shadow 0.3s;
            color: #fff;
        }

        .menu-button:hover {
            background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
            box-shadow: 0 4px 16px #0005;
        }

        /* Estilo personalizado para las barras de desplazamiento */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(90deg, #3a7bd5, #00d2ff);
        }

        ::-webkit-scrollbar-track {
            background: #181c20;
            border-radius: 4px;
        }

        .resizer-horizontal {
            height: 7px;
            background: #4d7dc013;
            cursor: row-resize;
            margin: 5px 0;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .resizer-horizontal:hover {
            background: #4d7dc081;
        }
    </style>
</head>

<body>
    <div class="header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <span id="file-path"
                style="margin-left: 10px; font-size: 0.8em; color: #7ecfff; opacity: 0.7; font-family: 'Cascadia Code PL', monospace;">
                Untitled
            </span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
            <span id="jsLabel"
                style="font-size:0.75em; color:#7ecfff; opacity:0.7; font-family:'Cascadia Code PL', monospace;">JS</span>
            <label class="switch-label" title="TypeScript Mode">
                <input type="checkbox" id="tsSwitch">
                <span class="slider"></span>
            </label>
            <span id="tsLabel"
                style="font-size:0.75em; color:#7ecfff; opacity:0.3; font-family:'Cascadia Code PL', monospace;">TS</span>
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <span id="AutoRunLabel"
                style="font-size:0.75em; color:#7ecfff; opacity:0.7; font-family:'Cascadia Code PL', monospace;">Auto
                Run</span>
            <label class="switch-label" title="Auto Run">
                <input type="checkbox" id="autoRunSwitch" checked>
                <span class="slider"></span>
            </label>

            <span class="manual-hint">Press <b>Ctrl+Enter</b> for manual run</span>
        </div>
    </div>

    <div class="container horizontal" id="container">
        <div class="editor-container" id="editor-container" style="width: 70%;">
            <div class="editor" id="editor"></div>
        </div>
        <div class="resizer" id="resizer"></div>
        <div class="output-container" id="output-container" style="width: 30%;">
            <div class="output-title">Variables</div>
            <div class="output" id="variables-output"
                style="margin-bottom:10px; min-height:100px; max-height:50%; overflow:auto;"></div>
            <div class="resizer-horizontal" id="resizer-horizontal"></div>
            <div class="output-title">Console</div>
            <div class="output" id="output">
                <pre style="font-family: 'Cascadia Code PL', Consolas, 'Courier New', monospace;"
                    id="output-content">Run your code to see the results here...</pre>
            </div>
        </div>
    </div>

    <script src="./node_modules/typescript/lib/typescript.js"></script>
    <script src="./node_modules/monaco-editor/min/vs/loader.js"></script>
    <script>
        require.config({ paths: { 'vs': './node_modules/monaco-editor/min/vs' } });
        let editor;
        let debounceTimeout;
        let autoRun = true;
        const autoRunSwitch = document.getElementById('autoRunSwitch');
        const tsSwitch = document.getElementById('tsSwitch');
        const jsLabel = document.getElementById('jsLabel');
        const tsLabel = document.getElementById('tsLabel');
        const AutoRunLabel = document.getElementById('AutoRunLabel');
        // Inicializa el editor en modo JavaScript
        let editorLanguage = 'javascript';
        tsSwitch.addEventListener('change', () => {
            editorLanguage = tsSwitch.checked ? 'typescript' : 'javascript';
            monaco.editor.setModelLanguage(editor.getModel(), editorLanguage);
            if (tsSwitch.checked) {
                jsLabel.style.opacity = '0.3';
                tsLabel.style.opacity = '0.7';
            } else {
                jsLabel.style.opacity = '0.7';
                tsLabel.style.opacity = '0.3';
            }
        });
        // Al cargar, asegúrate de que JS esté resaltado
        jsLabel.style.opacity = '0.7';
        tsLabel.style.opacity = '0.3';
        let lastCode = '';
        let orientation = 'horizontal';
        const container = document.getElementById('container');
        const editorContainer = document.getElementById('editor-container');
        const outputContainer = document.getElementById('output-container');
        const resizer = document.getElementById('resizer');
        const outputContent = document.getElementById('output-content');
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `// Write your JavaScript or TypeScript code here\n// For example:\nconst greeting: string = 'Hello, world!';\nconsole.log(greeting);\n\n// The result will appear in the console on the right`,
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true,
                minimap: { enabled: true },
                fontSize: 14,
                fontFamily: 'Cascadia Code PL',
                fontLigatures: true,
                lineHeight: 22,
                letterSpacing: 0.5,
                scrollBeyondLastLine: false,
                renderWhitespace: 'selection',
                tabSize: 2,
                lineNumbers: 'on',
                wordWrap: 'on',
                smoothScrolling: true,
                cursorSmoothCaretAnimation: true,
                mouseWheelZoom: true,
                renderLineHighlight: 'all',
                renderControlCharacters: true,
                matchBrackets: 'always',
                guides: {
                    indentation: true,
                    highlightActiveIndentation: true
                },
                quickSuggestions: true,
                suggestOnTriggerCharacters: true,
                parameterHints: { enabled: true },
                hover: { enabled: true },
                formatOnPaste: true,
                formatOnType: true,
                autoClosingBrackets: 'always',
                autoClosingQuotes: 'always',
                scrollbar: {
                    verticalScrollbarSize: 10,
                    horizontalScrollbarSize: 10
                }
            });
            editor.onDidChangeModelContent(() => {
                if (autoRun) {
                    clearTimeout(debounceTimeout);
                    debounceTimeout = setTimeout(executeCode, 500);
                }
            });
        });
        function updateAutoRunLabel() {
            if (autoRunSwitch.checked) {
                AutoRunLabel.style.opacity = '0.85';
            } else {
                AutoRunLabel.style.opacity = '0.3';
            }
        }
        updateAutoRunLabel();
        autoRunSwitch.addEventListener('change', () => {
            autoRun = autoRunSwitch.checked;
            updateAutoRunLabel();
            if (autoRun) executeCode();
        });
        window.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                executeCode();
            }
        });
        function executeCode() {
            const code = editor.getValue();
            outputContent.innerHTML = '';
            const variablesOutput = document.getElementById('variables-output');
            let varsHtml = ''; 
            try {
                let logs = [];

                // Utilidad para obtener la línea de ejecución
                function getLine() {
                    const err = new Error();
                    const stack = err.stack.split('\n');
                    for (let i = 2; i < stack.length; i++) {
                        const match = stack[i].match(/<anonymous>:(\d+):\d+/);
                        if (match) {
                            return parseInt(match[1], 10);
                        }
                    }
                    return '?';
                }
                // --- Captura variables ---
                const varNames = [];
                const varLines = {};
                const varRegex = /^\s*(let|const|var)\s+([a-zA-Z_$][\w$]*)/gm;
                let match;
                while ((match = varRegex.exec(code)) !== null) {
                    varNames.push(match[2]);
                    // Guardar la línea de declaración (basado en saltos de línea previos)
                    const before = code.slice(0, match.index);
                    varLines[match[2]] = (before.match(/\n/g) || []).length + 1;
                }

                // Creamos un objeto para exponer las variables
                let varsProxy = {};
                let instrumentedCode = code + '\n';
                varNames.forEach(v => {
                    instrumentedCode += `try { if (window.hasOwnProperty('${v}')) { window.__playground_vars__['${v}'] = ${v}; } else { window.__playground_vars__['${v}'] = ${v}; } } catch (e) { window.__playground_vars__['${v}'] = '<not evaluated>'; }\n`;
                });

                window.__playground_vars__ = {};

                // --- COMPILACIÓN TS ---
                let codeToEval = instrumentedCode;
                if (editorLanguage === 'typescript') {
                    try {
                        const transpileResult = window.ts.transpileModule(instrumentedCode, { compilerOptions: { module: window.ts.ModuleKind.None, target: window.ts.ScriptTarget.ESNext } });
                        if (transpileResult.diagnostics && transpileResult.diagnostics.length > 0) {
                            let tsErrors = transpileResult.diagnostics.map(d => d.messageText).join('<br>');
                            outputContent.innerHTML = `<span class=\"error\">TypeScript compile error:</span><br>${tsErrors}`;
                            variablesOutput.innerHTML = '<span style="color:#888">No global variables detected.</span>';
                            return;
                        }
                        codeToEval = transpileResult.outputText;
                    } catch (tsErr) {
                        outputContent.innerHTML = `<span class=\"error\">TypeScript transpile error:</span><br>${tsErr}`;
                        variablesOutput.innerHTML = '<span style="color:#888">No global variables detected.</span>';
                        return;
                    }
                }

                // Ejecutamos el código (ya JS si era TS)
                eval(codeToEval);

                // Mostrar variables y valores
                if (varNames.length > 0) {
                    varsHtml = varNames.map(v => {
                        let value = window.__playground_vars__ ? window.__playground_vars__[v] : '<not evaluated>';
                        if (!(v in window.__playground_vars__)) return '';
                        if (typeof value === 'string') {
                            value = `<span style=\"color:#ffa07a\">'${value}'</span>`;
                        } else if (typeof value === 'number') {
                            value = `<span style=\"color:#ffd700\">${value}</span>`;
                        } else if (typeof value === 'boolean') {
                            value = `<span style=\"color:#00bfff\">${value}</span>`;
                        } else if (value === null) {
                            value = `<span style=\"color:#1e90ff\">null</span>`;
                        } else if (value === undefined) {
                            value = `<span style=\"color:#1e90ff\">undefined</span>`;
                        } else if (typeof value === 'object' && value !== null) {
                            value = `<span style=\"color:#98fb98\">${JSON.stringify(value, null, 2)}</span>`;
                        } else {
                            value = `<span style=\"color:#e0e0e0\">${String(value)}</span>`;
                        }
                        return `<span style=\"color:#fff\">[Line ${varLines[v]}]</span> <span style=\"color:#7ecfff\">${v}</span>: ${value}`;
                    }).filter(Boolean).join('<br>');
                    if (!varsHtml) varsHtml = '<span style="color:#888">No global variables detected.</span>';
                } else {
                    varsHtml = '<span style="color:#888">No global variables detected.</span>';
                }
                variablesOutput.innerHTML = varsHtml;

            } catch (error) {
                variablesOutput.innerHTML = '<span style="color:#888">No global variables detected.</span>';
                outputContent.innerHTML = `<span class="error">✗ Execution error</span>\n\n${error}`;
            }
        }

        window.electron.ipcRenderer.on('code-result', (event, result) => {
            const code = editor.getValue();
            const outputContent = document.getElementById('output-content');
            if (result.success) {
                let output = `<span class=\"success\">✓ Successful execution</span>\n`;
                if (result.stdout) {
                    output += `<span style="color:#baffb8">${result.stdout}</span>\n`;
                }
                if (result.stderr) {
                    output += `<span class=\"error\">${result.stderr}</span>\n`;
                }
                outputContent.innerHTML = output;
            } else {
                outputContent.innerHTML = `<span class=\"error\">✗ Execution error</span>\n\n${result.error}`;
            }
        });

        // --- Lógica de manejo de archivos ---
        let currentFilePath = null;
        let currentFileName = null;

        async function handleNewFile() {
            const result = await window.electron.fileSystem.newFile();
            if (result) {
                editor.setValue(result.content);
                currentFilePath = null;
                currentFileName = 'Untitled.js';
                document.getElementById('file-path').textContent = currentFileName;
            }
        }
        async function handleOpenFile() {
            const result = await window.electron.fileSystem.openFile();
            if (result) {
                editor.setValue(result.content);
                currentFilePath = result.filePath;
                currentFileName = result.filePath.split(/[\\/]/).pop();
                document.getElementById('file-path').textContent = result.filePath || currentFileName;
                // Actualizar el modo del editor según la extensión del archivo
                if (result.filePath) {
                    const ext = result.filePath.split('.').pop().toLowerCase();
                    if (ext === 'ts' || ext === 'tsx') {
                        tsSwitch.checked = true;
                        editorLanguage = 'typescript';
                        jsLabel.style.opacity = '0.3';
                        tsLabel.style.opacity = '0.7';
                    } else {
                        tsSwitch.checked = false;
                        editorLanguage = 'javascript';
                        jsLabel.style.opacity = '0.7';
                        tsLabel.style.opacity = '0.3';
                    }
                    monaco.editor.setModelLanguage(editor.getModel(), editorLanguage);
                }
            }
        }
        async function handleSaveFile() {
            try {
                const content = editor.getValue();

                // Si ya hay un archivo abierto, guardar sobre ese mismo
                if (currentFilePath) {
                    await window.electron.ipcRenderer.invoke('dialog:saveFile', content, currentFilePath);
                    document.getElementById('file-path').textContent = currentFilePath;
                } else {
                    // Si es un archivo nuevo, mostrar diálogo para guardar
                    const suggestedName = currentFileName || 'Untitled.js';
                    const result = await window.electron.ipcRenderer.invoke('dialog:saveFile', content, suggestedName);

                    if (result) {
                        currentFilePath = result;
                        const fileName = result.split(/[\\/]/).pop();
                        currentFileName = fileName;
                        document.getElementById('file-path').textContent = fileName;
                    } 
                }
            } catch (error) {
                console.error('Error al guardar el archivo:', error);
                // Mostrar mensaje de error al usuario
                const outputContent = document.getElementById('output-content');
                outputContent.innerHTML = `<span class="error">Error al guardar el archivo: ${error.message || error}</span>`;
            }
        }
        // --- Listeners del menú nativo ---
        window.electron.ipcRenderer.on('menu-new-file', handleNewFile);
        window.electron.ipcRenderer.on('menu-open-file', handleOpenFile);
        window.electron.ipcRenderer.on('menu-save-file', handleSaveFile);
        // --- Atajos de teclado ---
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
                e.preventDefault();
                handleSaveFile();
            } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'o') {
                e.preventDefault();
                handleOpenFile();
            } else if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'n') {
                e.preventDefault();
                handleNewFile();
            }
        });

        // Agregar funcionalidad para ajustar el tamaño del editor y la consola
        resizer.addEventListener('mousedown', (e) => {
            e.preventDefault();
            document.body.style.cursor = 'col-resize';

            const onMouseMove = (event) => {
                const containerWidth = container.offsetWidth;
                const newEditorWidth = Math.min(
                    Math.max(event.clientX - container.offsetLeft, 100),
                    containerWidth - 100
                );
                editorContainer.style.width = `${(newEditorWidth / containerWidth) * 100}%`;
                outputContainer.style.width = `${100 - (newEditorWidth / containerWidth) * 100}%`;
            };

            const onMouseUp = () => {
                document.body.style.cursor = 'default';
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        // Agregar funcionalidad para ajustar el tamaño de la sección de variables y consola
        const resizerHorizontal = document.getElementById('resizer-horizontal');
        const variablesOutput = document.getElementById('variables-output');
        const consoleOutput = document.getElementById('output');

        resizerHorizontal.addEventListener('mousedown', (e) => {
            e.preventDefault();
            document.body.style.cursor = 'row-resize';

            const onMouseMove = (event) => {
                const containerHeight = resizerHorizontal.parentElement.offsetHeight;
                const minHeight = 20; // Altura mínima para ambas secciones
                const newVariablesHeight = Math.min(
                    Math.max(event.clientY - variablesOutput.getBoundingClientRect().top, minHeight),
                    containerHeight - minHeight - resizerHorizontal.offsetHeight
                );
                variablesOutput.style.height = `${newVariablesHeight}px`;
                consoleOutput.style.height = `${containerHeight - newVariablesHeight - resizerHorizontal.offsetHeight}px`;
            };

            const onMouseUp = () => {
                document.body.style.cursor = 'default';
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        });

        function createExpandableObjectView(obj) {
          const container = document.createElement('div');
          container.style.marginLeft = '10px';

          Object.keys(obj).forEach((key) => {
            const propertyRow = document.createElement('div');
            const keySpan = document.createElement('span');
            keySpan.textContent = key + ': ';
            keySpan.style.color = '#7ecfff';

            const valueSpan = document.createElement('span');
            const value = obj[key];

            if (typeof value === 'object' && value !== null) {
              valueSpan.textContent = '{...}';
              valueSpan.style.color = '#98fb98';
              valueSpan.style.cursor = 'pointer';

              const nestedView = createExpandableObjectView(value);
              nestedView.style.display = 'none';

              valueSpan.addEventListener('click', () => {
                nestedView.style.display = nestedView.style.display === 'none' ? 'block' : 'none';
              });

              propertyRow.appendChild(keySpan);
              propertyRow.appendChild(valueSpan);
              propertyRow.appendChild(nestedView);
            } else {
              valueSpan.textContent = JSON.stringify(value);
              valueSpan.style.color = '#e0e0e0';
              propertyRow.appendChild(keySpan);
              propertyRow.appendChild(valueSpan);
            }

            container.appendChild(propertyRow);
          });

          return container;
        }

        function redirectDevToolsConsole() {
          const originalConsole = { ...console };
          const outputContent = document.getElementById('output-content');

          // Almacenar un historial de logs para evitar duplicados
          const logHistory = new Set();

          ['log', 'warn', 'error', 'info', 'debug'].forEach((method) => {
            console[method] = (...args) => {
              // Enviar a la consola original (DevTools)
              originalConsole[method](...args);

              const line = (() => {
                try {
                  throw new Error();
                } catch (err) {
                  const stack = err.stack.split('\n');
                  for (let i = 2; i < stack.length; i++) {
                    const match = stack[i].match(/<anonymous>:(\d+):\d+/);
                    if (match) {
                      return parseInt(match[1], 10);
                    }
                  }
                }
                return '?';
              })();

              // Resolver promesas antes de mostrar en la consola personalizada
              Promise.all(
                args.map(async (arg) => {
                  if (arg instanceof Promise) {
                    try {
                      return await arg;
                    } catch (error) {
                      return `Error: ${error.message}`;
                    }
                  }
                  return arg;
                })
              ).then((resolvedArgs) => {
                const logEntry = document.createElement('div');
                logEntry.style.marginBottom = '10px';
                logEntry.style.display = 'flex';
                logEntry.style.alignItems = 'flex-start';

                const lineNumberContainer = document.createElement('div');
                lineNumberContainer.textContent = `[Line ${line}]:`;
                lineNumberContainer.style.color = '#7ecfff';
                lineNumberContainer.style.marginRight = '10px';
                lineNumberContainer.style.fontFamily = '"Cascadia Code PL", monospace';

                resolvedArgs.forEach((arg) => {
                  if (typeof arg === 'object' && arg !== null) {
                    const expandableView = createExpandableObjectView(arg);
                    logEntry.appendChild(expandableView);
                  } else {
                    const textNode = document.createElement('div');
                    textNode.textContent = JSON.stringify(arg);
                    textNode.style.color = '#e0e0e0';
                    logEntry.appendChild(textNode);
                  }
                });

                logEntry.prepend(lineNumberContainer);
                outputContent.appendChild(logEntry);
              });
            };
          });
        }

        redirectDevToolsConsole();
    </script>
</body>

</html>